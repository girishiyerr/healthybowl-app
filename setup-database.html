<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Setup - HealthyBowl</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .code-block {
            background: #1f2937;
            color: #f9fafb;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen py-12">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Header -->
            <div class="text-center mb-12">
                <h1 class="text-4xl font-bold text-green-600 mb-4">Database Setup</h1>
                <p class="text-xl text-gray-600">Set up your HealthyBowl database with Supabase</p>
            </div>

            <!-- Setup Steps -->
            <div class="space-y-8">
                <!-- Step 1: Database Schema -->
                <div class="bg-white rounded-2xl shadow-lg p-8 border border-green-100">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">Step 1: Create Database Schema</h2>
                    <p class="text-gray-600 mb-6">Copy and run this SQL in your Supabase SQL Editor:</p>
                    
                    <div class="code-block mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-400">SQL Schema</span>
                            <button onclick="copyToClipboard('schema')" class="text-green-400 hover:text-green-300 text-sm">
                                Copy to Clipboard
                            </button>
                        </div>
                        <pre id="schema" class="text-sm overflow-x-auto">-- Copy the entire contents of database-schema.sql file
-- and paste it into your Supabase SQL Editor</pre>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-blue-700">
                                    <strong>Note:</strong> This will create all tables, functions, triggers, and sample data for your HealthyBowl website.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Test Connection -->
                <div class="bg-white rounded-2xl shadow-lg p-8 border border-green-100">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">Step 2: Test Database Connection</h2>
                    <p class="text-gray-600 mb-6">Click the button below to test your database connection:</p>
                    
                    <button onclick="testConnection()" id="testBtn" 
                            class="bg-green-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-green-700 transition-colors">
                        Test Connection
                    </button>
                    
                    <div id="connectionStatus" class="mt-4 hidden">
                        <div id="connectionMessage" class="p-4 rounded-lg"></div>
                    </div>
                </div>

                <!-- Step 3: Verify Tables -->
                <div class="bg-white rounded-2xl shadow-lg p-8 border border-green-100">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">Step 3: Verify Database Tables</h2>
                    <p class="text-gray-600 mb-6">Check if all tables were created successfully:</p>
                    
                    <button onclick="verifyTables()" id="verifyBtn" 
                            class="bg-blue-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-blue-700 transition-colors">
                        Verify Tables
                    </button>
                    
                    <div id="tablesStatus" class="mt-4 hidden">
                        <div id="tablesMessage" class="p-4 rounded-lg"></div>
                    </div>
                </div>

                <!-- Step 4: Test Sample Data -->
                <div class="bg-white rounded-2xl shadow-lg p-8 border border-green-100">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">Step 4: Test Sample Data</h2>
                    <p class="text-gray-600 mb-6">Verify that sample data was inserted correctly:</p>
                    
                    <button onclick="testSampleData()" id="sampleBtn" 
                            class="bg-purple-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-purple-700 transition-colors">
                        Test Sample Data
                    </button>
                    
                    <div id="sampleStatus" class="mt-4 hidden">
                        <div id="sampleMessage" class="p-4 rounded-lg"></div>
                    </div>
                </div>

                <!-- Step 5: Create Sample Order -->
                <div class="bg-white rounded-2xl shadow-lg p-8 border border-green-100">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">Step 5: Create Sample Order for Testing</h2>
                    <p class="text-gray-600 mb-6">Create a sample order to test the order tracking page:</p>
                    
                    <button onclick="createSampleOrder()" id="sampleOrderBtn" 
                            class="bg-orange-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-orange-700 transition-colors">
                        Create Sample Order
                    </button>
                    
                    <div id="sampleOrderStatus" class="mt-4 hidden">
                        <div id="sampleOrderMessage" class="p-4 rounded-lg"></div>
                    </div>
                </div>

                <!-- Step 6: Test Order Status Updates -->
                <div class="bg-white rounded-2xl shadow-lg p-8 border border-green-100">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">Step 6: Test Order Status Updates</h2>
                    <p class="text-gray-600 mb-6">Test updating the order status to see real-time changes:</p>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <button onclick="updateOrderStatus('confirmed', 'Order confirmed by admin')" 
                                class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors">
                            Confirm Order
                        </button>
                        <button onclick="updateOrderStatus('preparing', 'Preparing your healthy bowl')" 
                                class="bg-yellow-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-yellow-700 transition-colors">
                            Start Preparing
                        </button>
                        <button onclick="updateOrderStatus('out_for_delivery', 'Out for delivery')" 
                                class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-purple-700 transition-colors">
                            Out for Delivery
                        </button>
                        <button onclick="updateOrderStatus('delivered', 'Order delivered successfully')" 
                                class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-green-700 transition-colors">
                            Mark Delivered
                        </button>
                    </div>
                    
                    <div id="statusUpdateStatus" class="mt-4 hidden">
                        <div id="statusUpdateMessage" class="p-4 rounded-lg"></div>
                    </div>
                </div>

                <!-- Step 7: Next Steps -->
                <div class="bg-white rounded-2xl shadow-lg p-8 border border-green-100">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">Step 7: Next Steps</h2>
                    <div class="space-y-4">
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                    <span class="text-green-600 font-bold">1</span>
                                </div>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-900">Update Your Pages</h3>
                                <p class="text-gray-600">Replace the checkout page with the database-integrated version</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                    <span class="text-green-600 font-bold">2</span>
                                </div>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-900">Test the Full Flow</h3>
                                <p class="text-gray-600">Add items to cart, proceed to checkout, and place an order</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                    <span class="text-green-600 font-bold">3</span>
                                </div>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-900">Set Up Admin Dashboard</h3>
                                <p class="text-gray-600">Create an admin interface to manage orders and customers</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase configuration
        const supabaseUrl = 'https://awnmurxunaenwzluhwge.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF3bm11cnh1bmFlbnd6bHVod2dlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwNzQyNjIsImV4cCI6MjA3MjY1MDI2Mn0.vgf0wzw8DmDAMUhPPxufVaHfkl5T2trnPqzF6ZHwIJ4'
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)

        // Copy to clipboard function
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId)
            const text = element.textContent
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard!')
            })
        }

        // Test database connection
        async function testConnection() {
            const testBtn = document.getElementById('testBtn')
            const statusDiv = document.getElementById('connectionStatus')
            const messageDiv = document.getElementById('connectionMessage')
            
            testBtn.disabled = true
            testBtn.textContent = 'Testing...'
            
            try {
                // Test connection by trying to access a table
                const { data, error } = await supabase
                    .from('products')
                    .select('count')
                    .limit(1)
                
                if (error) {
                    throw error
                }
                
                messageDiv.className = 'p-4 rounded-lg bg-green-50 border border-green-200'
                messageDiv.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-green-800">Connection Successful!</h3>
                            <p class="text-sm text-green-700 mt-1">Your database is connected and ready to use.</p>
                        </div>
                    </div>
                `
                statusDiv.classList.remove('hidden')
                
            } catch (error) {
                messageDiv.className = 'p-4 rounded-lg bg-red-50 border border-red-200'
                messageDiv.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-800">Connection Failed</h3>
                            <p class="text-sm text-red-700 mt-1">Error: ${error.message}</p>
                            <p class="text-sm text-red-700 mt-1">Make sure you've run the database schema first.</p>
                        </div>
                    </div>
                `
                statusDiv.classList.remove('hidden')
            }
            
            testBtn.disabled = false
            testBtn.textContent = 'Test Connection'
        }

        // Verify tables
        async function verifyTables() {
            const verifyBtn = document.getElementById('verifyBtn')
            const statusDiv = document.getElementById('tablesStatus')
            const messageDiv = document.getElementById('tablesMessage')
            
            verifyBtn.disabled = true
            verifyBtn.textContent = 'Verifying...'
            
            try {
                const expectedTables = [
                    'users', 'customer_addresses', 'products', 'orders', 
                    'order_items', 'contact_messages', 'coupons', 'delivery_areas'
                ]
                
                const results = []
                
                for (const table of expectedTables) {
                    try {
                        const { data, error } = await supabase
                            .from(table)
                            .select('*')
                            .limit(1)
                        
                        if (error) {
                            results.push({ table, status: 'error', message: error.message })
                        } else {
                            results.push({ table, status: 'success', message: 'Table exists' })
                        }
                    } catch (err) {
                        results.push({ table, status: 'error', message: err.message })
                    }
                }
                
                const successCount = results.filter(r => r.status === 'success').length
                const errorCount = results.filter(r => r.status === 'error').length
                
                if (errorCount === 0) {
                    messageDiv.className = 'p-4 rounded-lg bg-green-50 border border-green-200'
                    messageDiv.innerHTML = `
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-green-800">All Tables Created Successfully!</h3>
                                <p class="text-sm text-green-700 mt-1">${successCount} tables verified. Your database schema is complete.</p>
                            </div>
                        </div>
                    `
                } else {
                    messageDiv.className = 'p-4 rounded-lg bg-yellow-50 border border-yellow-200'
                    messageDiv.innerHTML = `
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-yellow-800">Some Tables Missing</h3>
                                <p class="text-sm text-yellow-700 mt-1">${successCount} tables found, ${errorCount} missing. Please run the database schema again.</p>
                                <div class="mt-2 text-xs text-yellow-600">
                                    <strong>Missing tables:</strong><br>
                                    ${results.filter(r => r.status === 'error').map(r => `• ${r.table}: ${r.message}`).join('<br>')}
                                </div>
                            </div>
                        </div>
                    `
                }
                
                statusDiv.classList.remove('hidden')
                
            } catch (error) {
                messageDiv.className = 'p-4 rounded-lg bg-red-50 border border-red-200'
                messageDiv.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-800">Verification Failed</h3>
                            <p class="text-sm text-red-700 mt-1">Error: ${error.message}</p>
                        </div>
                    </div>
                `
                statusDiv.classList.remove('hidden')
            }
            
            verifyBtn.disabled = false
            verifyBtn.textContent = 'Verify Tables'
        }

        // Test sample data
        async function testSampleData() {
            const sampleBtn = document.getElementById('sampleBtn')
            const statusDiv = document.getElementById('sampleStatus')
            const messageDiv = document.getElementById('sampleMessage')
            
            sampleBtn.disabled = true
            sampleBtn.textContent = 'Testing...'
            
            try {
                // Test products
                const { data: products, error: productsError } = await supabase
                    .from('products')
                    .select('*')
                
                if (productsError) throw productsError
                
                // Test coupons
                const { data: coupons, error: couponsError } = await supabase
                    .from('coupons')
                    .select('*')
                
                if (couponsError) throw couponsError
                
                // Test delivery areas
                const { data: areas, error: areasError } = await supabase
                    .from('delivery_areas')
                    .select('*')
                
                if (areasError) throw areasError
                
                messageDiv.className = 'p-4 rounded-lg bg-green-50 border border-green-200'
                messageDiv.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-green-800">Sample Data Loaded Successfully!</h3>
                            <p class="text-sm text-green-700 mt-1">
                                • ${products.length} products loaded<br>
                                • ${coupons.length} coupons loaded<br>
                                • ${areas.length} delivery areas loaded
                            </p>
                        </div>
                    </div>
                `
                statusDiv.classList.remove('hidden')
                
            } catch (error) {
                messageDiv.className = 'p-4 rounded-lg bg-red-50 border border-red-200'
                messageDiv.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-800">Sample Data Test Failed</h3>
                            <p class="text-sm text-red-700 mt-1">Error: ${error.message}</p>
                        </div>
                    </div>
                `
                statusDiv.classList.remove('hidden')
            }
            
            sampleBtn.disabled = false
            sampleBtn.textContent = 'Test Sample Data'
        }

        // Create sample order for testing
        async function createSampleOrder() {
            const sampleOrderBtn = document.getElementById('sampleOrderBtn')
            const statusDiv = document.getElementById('sampleOrderStatus')
            const messageDiv = document.getElementById('sampleOrderMessage')
            
            sampleOrderBtn.disabled = true
            sampleOrderBtn.textContent = 'Creating Order...'
            
            try {
                // Create sample order data
                const sampleOrderData = {
                    p_user_id: null, // Guest order
                    p_customer_email: 'test@healthybowl.in',
                    p_customer_first_name: 'John',
                    p_customer_last_name: 'Doe',
                    p_customer_phone: '+91 98765 43210',
                    p_billing_address: {
                        street: '123 Test Street',
                        city: 'Mumbai',
                        state: 'Maharashtra',
                        pincode: '400001',
                        landmark: 'Near Test Mall'
                    },
                    p_subtotal: 1200.00,
                    p_gst_amount: 60.00,
                    p_order_items: [
                        {
                            name: '250ml Weekly Plan',
                            size: 250,
                            period: 'Weekly',
                            quantity: 2,
                            price: 600.00
                        }
                    ],
                    p_discount_amount: 0,
                    p_coupon_id: null,
                    p_coupon_code: null,
                    p_delivery_instructions: 'Please deliver between 7-9 AM'
                }
                
                // Create the order
                const { data: orderId, error: orderError } = await supabase
                    .rpc('create_order_with_items', sampleOrderData)
                
                if (orderError) throw orderError
                
                // Get the order details to show tracking ID
                const { data: order, error: orderDetailsError } = await supabase
                    .from('orders')
                    .select('order_number, status, created_at')
                    .eq('id', orderId)
                    .single()
                
                if (orderDetailsError) throw orderDetailsError
                
                messageDiv.className = 'p-4 rounded-lg bg-green-50 border border-green-200'
                messageDiv.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-green-800">Sample Order Created Successfully!</h3>
                            <div class="text-sm text-green-700 mt-2">
                                <p><strong>Tracking ID:</strong> <span class="font-mono bg-green-100 px-2 py-1 rounded">${order.order_number}</span></p>
                                <p><strong>Status:</strong> ${order.status}</p>
                                <p><strong>Created:</strong> ${new Date(order.created_at).toLocaleString()}</p>
                                <div class="mt-3">
                                    <a href="/order-tracking?tracking_id=${order.order_number}" 
                                       class="inline-flex items-center px-4 py-2 bg-orange-600 text-white text-sm font-medium rounded-lg hover:bg-orange-700 transition-colors">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                        </svg>
                                        Test Order Tracking Page
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `
                statusDiv.classList.remove('hidden')
                
            } catch (error) {
                messageDiv.className = 'p-4 rounded-lg bg-red-50 border border-red-200'
                messageDiv.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-800">Sample Order Creation Failed</h3>
                            <p class="text-sm text-red-700 mt-1">Error: ${error.message}</p>
                        </div>
                    </div>
                `
                statusDiv.classList.remove('hidden')
            }
            
            sampleOrderBtn.disabled = false
            sampleOrderBtn.textContent = 'Create Sample Order'
        }

        // Update order status
        async function updateOrderStatus(status, notes) {
            const statusDiv = document.getElementById('statusUpdateStatus')
            const messageDiv = document.getElementById('statusUpdateMessage')
            
            try {
                // Use the tracking ID from the sample order (you can make this dynamic)
                const trackingId = 'HB-20250905-0001' // This should be stored from the sample order creation
                
                const { data, error } = await supabase
                    .rpc('update_order_status', {
                        p_order_number: trackingId,
                        p_status: status,
                        p_notes: notes,
                        p_created_by: 'admin'
                    })
                
                if (error) throw error
                
                if (data) {
                    messageDiv.className = 'p-4 rounded-lg bg-green-50 border border-green-200'
                    messageDiv.innerHTML = `
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-green-800">Order Status Updated!</h3>
                                <p class="text-sm text-green-700 mt-1">
                                    Status changed to: <strong>${status}</strong><br>
                                    Notes: ${notes}
                                </p>
                                <div class="mt-2">
                                    <a href="/order-tracking?tracking_id=${trackingId}" 
                                       class="text-sm text-green-600 hover:text-green-500 underline">
                                        View updated order tracking page →
                                    </a>
                                </div>
                            </div>
                        </div>
                    `
                } else {
                    throw new Error('Failed to update order status')
                }
                
                statusDiv.classList.remove('hidden')
                
            } catch (error) {
                messageDiv.className = 'p-4 rounded-lg bg-red-50 border border-red-200'
                messageDiv.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-800">Status Update Failed</h3>
                            <p class="text-sm text-red-700 mt-1">Error: ${error.message}</p>
                        </div>
                    </div>
                `
                statusDiv.classList.remove('hidden')
            }
        }
    </script>
</body>
</html>

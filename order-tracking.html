<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Tracking - HealthyBowl</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .tracking-step {
            transition: all 0.3s ease;
        }
        .tracking-step.active {
            transform: scale(1.05);
        }
        .tracking-step.completed {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .tracking-step.pending {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
<header class="bg-white shadow-sm border-b sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-4">
            <div class="flex items-center">
                <img src="logo.png" alt="HealthyBowl Logo" class="h-32 sm:h-36 w-auto object-contain -mb-3">
            </div>
            <a href="/homepage" class="bg-green-600 text-white px-4 py-2 lg:px-6 lg:py-3 rounded-lg hover:bg-green-700 transition-colors text-sm lg:text-lg font-semibold shadow-lg hover:shadow-xl transform hover:scale-105">
                ← Back to Home
            </a>
        </div>
    </div>
</header>    <!-- Main Content -->
    <main class="py-16 bg-gradient-to-br from-gray-50 via-white to-green-50 relative overflow-hidden">
        <!-- Background Decorative Elements -->
        <div class="absolute inset-0 z-0">
            <div class="absolute top-10 left-10 w-16 h-16 bg-green-200 rounded-full opacity-20 animate-pulse"></div>
            <div class="absolute bottom-20 right-16 w-20 h-20 bg-orange-200 rounded-full opacity-20 animate-bounce" style="animation-delay: 1s;"></div>
            <div class="absolute top-1/2 left-1/4 w-12 h-12 bg-green-300 rounded-full opacity-15 animate-pulse" style="animation-delay: 0.5s;"></div>
            <div class="absolute top-1/3 right-1/4 w-14 h-14 bg-orange-300 rounded-full opacity-15 animate-bounce" style="animation-delay: 1.5s;"></div>
        </div>

        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <!-- Page Header -->
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-bold text-green-600 mb-4">Track Your Order</h1>
                <p class="text-xl text-gray-600">Enter your tracking ID to see the status of your order</p>
            </div>

            <!-- Tracking Input Section -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8 border border-green-100">
                <div class="max-w-2xl mx-auto">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">Enter Tracking ID</h2>
                        <p class="text-gray-600">Your tracking ID was sent to your email after order confirmation</p>
                    </div>

                    <form id="trackingForm" class="space-y-6">
                        <div>
                            <label for="trackingId" class="block text-sm font-semibold text-gray-700 mb-2">Tracking ID</label>
                            <div class="flex gap-4">
                                <input type="text" id="trackingId" name="trackingId" required
                                       class="flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors"
                                       placeholder="Enter your tracking ID (e.g., HB-20241201-0001)">
                                <button type="submit" id="trackBtn"
                                        class="bg-green-600 text-white px-8 py-3 rounded-xl font-semibold hover:bg-green-700 transition-colors">
                                    Track Order
                                </button>
                            </div>
                        </div>
                    </form>

                    <!-- Quick Links -->
                    <div class="mt-6 text-center">
                        <p class="text-sm text-gray-600 mb-4">Don't have your tracking ID?</p>
                        <div class="flex flex-col sm:flex-row gap-4 justify-center">
                            <a href="/contact" class="text-green-600 hover:text-green-800 font-semibold">
                                Contact Support
                            </a>
                            <span class="hidden sm:block text-gray-300">|</span>
                            <a href="homepage" class="text-green-600 hover:text-green-800 font-semibold">
                                Place New Order
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Order Details Section (Hidden initially) -->
            <div id="orderDetails" class="hidden">
                <!-- Order Summary Card -->
                <div class="bg-white rounded-2xl shadow-lg p-8 mb-8 border border-green-100">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 mb-2">Order Summary</h2>
                            <p class="text-gray-600">Order placed on <span id="orderDate"></span></p>
                        </div>
                        <div class="mt-4 lg:mt-0">
                            <div class="text-right">
                                <p class="text-sm text-gray-600">Order Number</p>
                                <p class="text-xl font-bold text-green-600" id="orderNumber"></p>
                            </div>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6">
                        <!-- Customer Info -->
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-3">Customer Information</h3>
                            <div class="space-y-2">
                                <p><span class="font-medium">Name:</span> <span id="customerName"></span></p>
                                <p><span class="font-medium">Email:</span> <span id="customerEmail"></span></p>
                                <p><span class="font-medium">Phone:</span> <span id="customerPhone"></span></p>
                            </div>
                        </div>

                        <!-- Delivery Info -->
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-3">Delivery Information</h3>
                            <div class="space-y-2">
                                <p><span class="font-medium">Address:</span> <span id="deliveryAddress"></span></p>
                                <p><span class="font-medium">Pincode:</span> <span id="deliveryPincode"></span></p>
                                <p><span class="font-medium">Instructions:</span> <span id="deliveryInstructions"></span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Order Status Timeline -->
                <div class="bg-white rounded-2xl shadow-lg p-8 mb-8 border border-green-100">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Order Status</h2>
                    
                    <div class="relative">
                        <!-- Timeline Line -->
                        <div class="absolute left-8 top-0 bottom-0 w-0.5 bg-gray-200"></div>
                        
                        <!-- Status Steps -->
                        <div class="space-y-8">
                            <!-- Order Placed -->
                            <div class="tracking-step relative flex items-start space-x-4 p-4 rounded-xl" id="step-placed">
                                <div class="flex-shrink-0 w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center">
                                    <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-lg font-semibold text-gray-900">Order Placed</h3>
                                    <p class="text-gray-600">Your order has been received and is being processed</p>
                                    <p class="text-sm text-gray-500 mt-1" id="placedTime"></p>
                                </div>
                            </div>

                            <!-- Order Confirmed -->
                            <div class="tracking-step relative flex items-start space-x-4 p-4 rounded-xl" id="step-confirmed">
                                <div class="flex-shrink-0 w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center">
                                    <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-lg font-semibold text-gray-900">Order Confirmed</h3>
                                    <p class="text-gray-600">Payment received and order confirmed</p>
                                    <p class="text-sm text-gray-500 mt-1" id="confirmedTime"></p>
                                </div>
                            </div>

                            <!-- Preparing -->
                            <div class="tracking-step relative flex items-start space-x-4 p-4 rounded-xl" id="step-preparing">
                                <div class="flex-shrink-0 w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center">
                                    <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-lg font-semibold text-gray-900">Preparing Your Order</h3>
                                    <p class="text-gray-600">Fresh ingredients are being prepared for your order</p>
                                    <p class="text-sm text-gray-500 mt-1" id="preparingTime"></p>
                                </div>
                            </div>

                            <!-- Out for Delivery -->
                            <div class="tracking-step relative flex items-start space-x-4 p-4 rounded-xl" id="step-delivery">
                                <div class="flex-shrink-0 w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center">
                                    <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-lg font-semibold text-gray-900">Out for Delivery</h3>
                                    <p class="text-gray-600">Your order is on its way to you</p>
                                    <p class="text-sm text-gray-500 mt-1" id="deliveryTime"></p>
                                </div>
                            </div>

                            <!-- Delivered -->
                            <div class="tracking-step relative flex items-start space-x-4 p-4 rounded-xl" id="step-delivered">
                                <div class="flex-shrink-0 w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center">
                                    <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v6H8V5z"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-lg font-semibold text-gray-900">Delivered</h3>
                                    <p class="text-gray-600">Your order has been successfully delivered</p>
                                    <p class="text-sm text-gray-500 mt-1" id="deliveredTime"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Order Items -->
                <div class="bg-white rounded-2xl shadow-lg p-8 mb-8 border border-green-100">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Order Items</h2>
                    
                    <div id="orderItems" class="space-y-4">
                        <!-- Order items will be loaded here -->
                    </div>

                    <!-- Order Total -->
                    <div class="border-t border-gray-200 pt-6 mt-6">
                        <div class="flex justify-between items-center text-lg font-semibold">
                            <span>Total Amount</span>
                            <span class="text-green-600" id="orderTotal">₹0</span>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="bg-white rounded-2xl shadow-lg p-8 border border-green-100">
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <button onclick="printOrder()" class="bg-gray-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-gray-700 transition-colors">
                            <i class="fas fa-print mr-2"></i>Print Order
                        </button>
                        <a href="/contact" class="bg-green-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-green-700 transition-colors text-center">
                            <i class="fas fa-headset mr-2"></i>Contact Support
                        </a>
                        <a href="homepage" class="bg-orange-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-orange-700 transition-colors text-center">
                            <i class="fas fa-plus mr-2"></i>Place New Order
                        </a>
                    </div>
                </div>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="hidden bg-red-50 border border-red-200 rounded-2xl p-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-red-800">Order Not Found</h3>
                        <p class="text-sm text-red-700 mt-1" id="errorText">The tracking ID you entered does not exist. Please check and try again.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white relative overflow-hidden">
        <div class="absolute inset-0 z-0">
            <div class="absolute top-10 left-10 w-16 h-16 bg-green-600 rounded-full opacity-10 animate-pulse"></div>
            <div class="absolute bottom-20 right-16 w-20 h-20 bg-orange-500 rounded-full opacity-10 animate-bounce" style="animation-delay: 1s;"></div>
        </div>
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="py-8 text-center">
                <p class="text-gray-400">&copy; 2024 HealthyBowl. All rights reserved.</p>
                <p class="text-gray-500 text-sm mt-1">HealthyBowl Foods Private Limited</p>
            </div>
        </div>
    </footer>

    <script>
        // Supabase configuration
        const supabaseUrl = 'https://awnmurxunaenwzluhwge.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF3bm11cnh1bmFlbnd6bHVod2dlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwNzQyNjIsImV4cCI6MjA3MjY1MDI2Mn0.vgf0wzw8DmDAMUhPPxufVaHfkl5T2trnPqzF6ZHwIJ4'
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)

        // Check for tracking ID in URL parameters
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search)
            const trackingId = urlParams.get('tracking_id')
            
            if (trackingId) {
                document.getElementById('trackingId').value = trackingId
                trackOrder(trackingId)
            }
        })

        // Handle form submission
        document.getElementById('trackingForm').addEventListener('submit', function(e) {
            e.preventDefault()
            const trackingId = document.getElementById('trackingId').value.trim()
            
            if (trackingId) {
                trackOrder(trackingId)
            }
        })

        // Track order function
        async function trackOrder(trackingId) {
            const trackBtn = document.getElementById('trackBtn')
            const orderDetails = document.getElementById('orderDetails')
            const errorMessage = document.getElementById('errorMessage')
            
            // Show loading state
            trackBtn.disabled = true
            trackBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Tracking...'
            
            try {
                // Get order details
                const { data: order, error: orderError } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        order_items (*)
                    `)
                    .eq('order_number', trackingId)
                    .single()
                
                if (orderError) throw orderError
                
                if (!order) {
                    throw new Error('Order not found')
                }
                
                // Hide error message and show order details
                errorMessage.classList.add('hidden')
                orderDetails.classList.remove('hidden')
                
                // Populate order information
                populateOrderDetails(order)
                
                // Update order status timeline
                updateOrderStatus(order.status, order.payment_status)
                
            } catch (error) {
                console.error('Error tracking order:', error)
                
                // Show error message
                orderDetails.classList.add('hidden')
                errorMessage.classList.remove('hidden')
                document.getElementById('errorText').textContent = 
                    error.message || 'Order not found. Please check your tracking ID and try again.'
            } finally {
                // Reset button state
                trackBtn.disabled = false
                trackBtn.innerHTML = 'Track Order'
            }
        }

        // Populate order details
        function populateOrderDetails(order) {
            // Basic order info
            document.getElementById('orderNumber').textContent = order.order_number
            document.getElementById('orderDate').textContent = new Date(order.created_at).toLocaleDateString('en-IN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            })
            
            // Customer info
            document.getElementById('customerName').textContent = `${order.customer_first_name} ${order.customer_last_name}`
            document.getElementById('customerEmail').textContent = order.customer_email
            document.getElementById('customerPhone').textContent = order.customer_phone || 'Not provided'
            
            // Delivery info
            const address = order.billing_address
            let addressText = ''
            let pincode = ''
            
            if (address) {
                // Handle different address formats
                if (address.street) {
                    // New format: street, city, state, pincode, landmark
                    addressText = `${address.street}`
                    if (address.city) addressText += `, ${address.city}`
                    if (address.state) addressText += `, ${address.state}`
                    if (address.landmark) addressText += ` (${address.landmark})`
                    pincode = address.pincode || ''
                } else if (address.line1) {
                    // Old format: line1, line2, pincode
                    addressText = address.line1
                    if (address.line2) addressText += `, ${address.line2}`
                    pincode = address.pincode || ''
                } else {
                    addressText = 'Address not provided'
                }
            } else {
                addressText = 'Address not provided'
            }
            
            document.getElementById('deliveryAddress').textContent = addressText
            document.getElementById('deliveryPincode').textContent = pincode
            document.getElementById('deliveryInstructions').textContent = order.delivery_instructions || 'No special instructions'
            
            // Order items
            const orderItems = document.getElementById('orderItems')
            orderItems.innerHTML = ''
            
            order.order_items.forEach(item => {
                const itemDiv = document.createElement('div')
                itemDiv.className = 'flex justify-between items-center py-4 border-b border-gray-100 last:border-b-0'
                itemDiv.innerHTML = `
                    <div class="flex-1">
                        <h4 class="font-semibold text-gray-900">${item.product_name}</h4>
                        <p class="text-sm text-gray-600">${item.product_size_ml}ml - ${item.plan_type} Plan</p>
                    </div>
                    <div class="text-right">
                        <p class="font-semibold text-gray-900">₹${item.total_price.toLocaleString()}</p>
                        <p class="text-sm text-gray-600">Qty: ${item.quantity}</p>
                    </div>
                `
                orderItems.appendChild(itemDiv)
            })
            
            // Order total
            document.getElementById('orderTotal').textContent = `₹${order.total_amount.toLocaleString()}`
        }

        // Update order status timeline
        function updateOrderStatus(status, paymentStatus) {
            const statusSteps = {
                'pending': ['step-placed'],
                'confirmed': ['step-placed', 'step-confirmed'],
                'preparing': ['step-placed', 'step-confirmed', 'step-preparing'],
                'out_for_delivery': ['step-placed', 'step-confirmed', 'step-preparing', 'step-delivery'],
                'delivered': ['step-placed', 'step-confirmed', 'step-preparing', 'step-delivery', 'step-delivered']
            }
            
            const currentSteps = statusSteps[status] || ['step-placed']
            
            // Reset all steps
            Object.keys(statusSteps).forEach(step => {
                const stepElement = document.getElementById(step)
                if (stepElement) {
                    stepElement.classList.remove('completed', 'active', 'pending')
                    stepElement.classList.add('pending')
                }
            })
            
            // Mark completed steps
            currentSteps.forEach(step => {
                const stepElement = document.getElementById(step)
                if (stepElement) {
                    stepElement.classList.remove('pending', 'active')
                    stepElement.classList.add('completed')
                }
            })
            
            // Mark current step as active
            const currentStep = currentSteps[currentSteps.length - 1]
            const currentStepElement = document.getElementById(currentStep)
            if (currentStepElement && status !== 'delivered') {
                currentStepElement.classList.add('active', 'pulse-animation')
            }
            
            // Update timestamps
            updateTimestamps(status)
        }

        // Update timestamps
        function updateTimestamps(status) {
            const now = new Date()
            const timeString = now.toLocaleString('en-IN', {
                hour: '2-digit',
                minute: '2-digit',
                day: '2-digit',
                month: 'short'
            })
            
            // Update timestamps based on status
            if (status === 'pending') {
                document.getElementById('placedTime').textContent = `Placed on ${timeString}`
            } else if (status === 'confirmed') {
                document.getElementById('placedTime').textContent = `Placed on ${timeString}`
                document.getElementById('confirmedTime').textContent = `Confirmed on ${timeString}`
            } else if (status === 'preparing') {
                document.getElementById('placedTime').textContent = `Placed on ${timeString}`
                document.getElementById('confirmedTime').textContent = `Confirmed on ${timeString}`
                document.getElementById('preparingTime').textContent = `Started on ${timeString}`
            } else if (status === 'out_for_delivery') {
                document.getElementById('placedTime').textContent = `Placed on ${timeString}`
                document.getElementById('confirmedTime').textContent = `Confirmed on ${timeString}`
                document.getElementById('preparingTime').textContent = `Started on ${timeString}`
                document.getElementById('deliveryTime').textContent = `Out for delivery on ${timeString}`
            } else if (status === 'delivered') {
                document.getElementById('placedTime').textContent = `Placed on ${timeString}`
                document.getElementById('confirmedTime').textContent = `Confirmed on ${timeString}`
                document.getElementById('preparingTime').textContent = `Started on ${timeString}`
                document.getElementById('deliveryTime').textContent = `Out for delivery on ${timeString}`
                document.getElementById('deliveredTime').textContent = `Delivered on ${timeString}`
            }
        }

        // Print order function
        function printOrder() {
            window.print()
        }
    </script>
</body>
</html>
